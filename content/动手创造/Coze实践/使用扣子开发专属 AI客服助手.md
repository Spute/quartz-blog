---
title: 使用扣子开发专属 AI 客服助手
---

# 前言

你是否想拥有一个 7× 24 小时在线的智能客服助手？使用扣子可以帮你做到。

接下来几期，我们将一起使用扣子来一步步实现自己的专属客服助手。

老伙计都知道学习一个新东西，有个非常好用的方法论叫做“抄操超钞”。
• 抄：学习复制他人成功的经验
• 操：动手实践，刻意练习，掌握细节
• 超：超越，创新。需要建立在足够的知识密度之上，拆开重新组合才能实现超越
• 钞：顺应市场，如此才有价值，用户会花钱买单。
我们先从第一步，也就是从模仿开始。而官方作为平台的设计者，是非常好的模仿对象。

## 搜索

如下操作，我们可以在扣子模板中搜索，输入关键字，可以发现有个扣子官方的智能客服助手。

![[LVoQbYFFxotqEDxheGvcihvkncS.png]]

## 复制

如下，点击复制按钮，将这个智能体复制到自己的工作区中。

![[VNREbuPR5oV9Jzx2k64ct90DneX.png]]

## 进入编排页面

进入编排页面后，我可以比较容易发现这个智能客服的核心逻辑是通过工作流实现的。我们重点看看这个工作流是如何实现扣子的智能问答的。

![[NHlEb2eMqoXCCzxlBtOc93IUnqc.png]]

## 查看工作流

进入工作流后，可以看出这个流程还是比较复杂的，从左到右有更多节点和分支。其中有使用到意图识别节点，作用是对不同类型的问题采取不同的回答策略。

![[IUgAbrVWXoQbiJxhpEacaPLlneD.png]]

### 知识库

然后就是知识库，因为客服工作会涉及“专有知识”，这些知识是 AI 不知道的，都需要“喂给”AI。所以模板里也配置专有的知识库，实现对专有知识的问答。

![[CouQbYT4voZQWIxyuI1cLnETnNb.png]]

### 数据存储

最后是数据存储，用户的问题一种有价值的数据，有必要存储下来。如下图，模板使用飞书多维表格保存用户问题。

![[WajpbM1RToGeeGxwIE4chxT0n0d.png]]

## 小结

今天初步了解官方扣子智能体助手的主要实现逻辑，后续我们将尝试动手实现一个小功能。

# 配置知识库

前面我们了解到官方扣子智能体助手的主要实现逻辑，接下来我们先尝试动手实现一个实用的小功能。让 AI 智能体客服回答预设问题。这是客服助手的关键能力之一，可以应用到很多场景。如：

1. 电商平台上，顾客咨询商品售后，AI 智能体客服依据预设问题引导用户，高效解决顾客难题。
2. 作为公众号客服助手，当用户咨询时，根据预设问题给与相关资料，提高用户粘性，引导用户填写表单等。

要实现这个功能需要创建一个预设问题的知识库，然后实现基于预设问题的问答。以下知识库节点的操作步骤：

## 创建知识库

如图，点击创建知识库，选择表格格式，输入名称，我们先使用自定义方式导入数据。

ps：选择表格是因为表格属于结构化数据，识别准确度更高，更简单。文本格式的涉及到内容分块处理，会相对复杂，后面再介绍。

![[LLyRbUcsQoBUq5xjz6VcTWz1nqb.png]]

## 创建表结构

创建好知识库后，设置表有那些字段，因为我们是预设问题，只需一问一答两字段，数据类型都是 String（字符串类型）。然后选择“问题”字段作为索引。

![[GLVLbI5j1oIrx7xr0RUcohkOnEd.png]]

## 添加内容

有了结构后，接下来就是加入数据了。如下图，我手动增加了一行。

![[J8khbSuqHoKN9pxY8YzcQPsIn7c.png]]

## 将知识库添加到节点中

把刚刚创建的知识库添加到工作流知识库节点中。

![[ZWQtbwxTioiDEPxOePPco9NRnHe.png]]

## 测试知识库节点

配置好后，我可以选择测试这个知识库节点。这不不是必须的，但是推荐大家试一下。测试在应用开发中是非常重要的一部分，测试驱动开发也是软件开发中非常重要的方法论。

如下：输入与预设问题相似的问题，也可以匹配到对应的答案。符合预期。

> [!TIP]
> 输出的结果是有多层的，需要点击">"图标展开。

![[EK6jbZqPLodzffx4JLRcDi97ncb.png]]

## 小结

设置好知识库节点是实现基于预设问题问答的第一步，后续将增加大语言模型节点，对检索到的回答进行加工，提供客服助手的更专业更智能。

# 配置大语言模型

前面设置好知识库节点后，可以实现预设问题的检索，并返回预设的答案。但是如果直接返回，显得很生硬，所以这节我们加上大语言模型节点，对预设答案进行优化加工。

我们使用公众号客服助手作为目标场景（对于其他场景只需适当的修改即可）。

如下是效果展示：

ps: 接入公众号的教程可以参考[如果你还不知道如何入场 AI，不妨试试这个--公众号接入自己的 AI 应用](https://iixchzsb7i.feishu.cn/docx/XnJrd7o0foV0TCxVFVkcSxnfnvd)

以下是工作流整体情况：

![[KxetbcMakop2iFxWufJc6rS1ndf.png]]

接下来我们一起来配置大模型节点

## 配置输入

在配置输入参数前一定要将节点使用线条连接起来，否则选不到其他节点的变量。

配置第一人输入参数，用于接收用户输入的问题

![[W6b9bIiR3oVmwFxfcwrcheTRnLg.png]]

配置第二个输入参数，用于接收知识库的检索到的预设问题。

![[DOrebVwLCoCchPxcsRecGIJenkf.png]]

## 配置系统提示词

系统提示词作用：提供系统级指导，设定人设和回复逻辑

如下我使用的是 AI 自动优化方式，生成提示词，效果不够完美，但是也可以使用。

![[FKSFbF2BOo59NLxTJpLcjOldnTg.png]]

## 配置用户提示词

用户提示词属于更细致的指令，适合增加一些动态数据的补充说明。

如下是用户提示词：

其中有 3 个被双大括号括上的是参数名。参数代码接收到的动态数据，这个<strong>参数名要与第一步配置输入相同（可以通过修改的方式保存一致）</strong>。

```sql
用户咨询{{input}}，知识库匹配结果是{{resp}}，你需要根据你的技能给他回复：
- 如果{{resp}}不为空，则总结一下知识库的召回内容，给出回复
```

![[HCHsbF8bCoG05axCPQ7cLLKdnaf.png]]

## 配置结束节点

配置好后，将大模型节点与结束节点连接，将大模型的输出作为结束节点的参数名

![[XMqfbnFJRool2qxK3g5cRIMsnse.png]]

## 试运行工作流

![[Y8oEbi9Gmo9ilLxGG5dcAEt7nYc.png]]

## 小结

如此基于预设问题问答 AI 客服助手最小 demo 就此完成了 🎉。你可以像我一样发布到自己的微信订阅号，或者其他平台。

# 存储数据

上一节我们完成了 AI 客服助手最小 demo，相当于完成了一个小闭环。接下来我们将对它进行迭代优化。这节的优化方向是将一些重要的数据永久保存起来。用户的问题一种有价值的数据，可以帮助我们理解分析用户需求，优化完善我们的知识库；其次是回答的结果也有必要存储下来，它可以帮我们复盘，检查回答的质量，发现问题，改善提示词等。

我们这次目标是加入一个存储数据的节点，效果如下：

![[QRQPbR0oeoLe1VxVAiOc2Mllneb.png]]

接下来让我们一步步来实现：

## 添加节点

选择添加节点，找的数据库分组，选择“新增数据”节点

![[B85zbww26oJNr2xD1FscHzClnng.png]]

## 创建数据库

点开节点的配置页，点击如下加号按钮添加数据表

![[ALhZbrKrMosvLAxN8adc4HlTnWh.png]]

如果没有数据表需要先创建一个

![[TybYbaGzHoNP4BxxN5lcbo3on6c.png]]

创建字段时，可以让 AI 帮忙自动生成存储字段，然后点击保存

![[XMvbbcZlXofEiGxU4aBc6igTnya.png]]

## 配置节点

将刚创建的数据表添加到“新增数据”节点中。

![[MQgBbDpb8or8EVxf8TEcfk1NnEe.png]]

将用户输入的问题作为 question 字段的值。

tip:设置参数值前需要先将节点与其他节点连接，不然无法引用参数值。

![[Dtb0bdothoMyHCxdsnxcC2IunAf.png]]

将大模型的输出作为 answer 字段的值

![[R5RWbf4agoVYnPxrmM6cEzvknvd.png]]

## 测试

使用试运行对整个流程进行测试，实验效果。

![[RKz8by3ScoUHumxbN3PcOBWInMf.png]]

## 查看数据

试运行完成后，点击数据表进入数据表详情页

![[TNMsb8LEToDKROxJegccGaCvngg.png]]

发现数据表中多了一个测试数据，成功记录了刚刚的问题和回答。

![[E6KRbhZSyompYXxIPVhchWLrnOh.png]]

## 小结

如此数据存储功能就此完成了。如果需要添加一些数据，只需在数据表中增加对应字段，然后在节点中配置相应的参数即可实现。

基于扣子自带的数据库是数据存储的方案之一，你还可以将数据存储到飞书多维表格中，甚至可以通过 api 接口存储到你想要的地方。实现路径很多，但基本原理是一样的。有想法的朋友可以动手试试。

# 意图识别

上一节我们添加了存储数据功能。这次我们的优化方向是增加一个防呆功能，应对当用户问一些无关问题的场景。先来看看这个问题的影响：

通过试运行，我们发现当用户问一些与主题无关问题时，仍然会经过知识库查询和数据存储节点。这会导致花费额外的时间。

![[OYCxbKU35oCLcOxMAfYcOc24nrb.png]]

并且数据库中存储了没有价值的“无关问题”。

![[W6uNbzP3uo40X9xmOOXcNfm8ngc.png]]

对于这种场景，我们可以使用意图识别节点，进行优化：

## 增加意图识别节点

![[AlDVb8xlWoExmWx0unGcThfknCd.png]]

将用户的输入作为节点输入，然后加上意图识别，如下图，增加了“产品售后问题”的意图识别。如此配置后当输入的问题属于“产品售后问题”会走上面那条分支，反之属于“其他意图”走下面那条分支。

![[AcO8bXjfQo4ZQ8xweYHcNK9Qnii.png]]

## 增加大模型节点

增加大模型节点优化“其他意图”的输出。如下配置输入，系统提示词和用户提示词。

![[Od5EbChIIoFFnGxM6ZFcvPI5n9d.png]]

用户提示词

```markdown
用户输入:{{input}}
```

## 增加变量聚合节点

因为结束节点只能接受一个统一的变量，而前面的意图识别产生了两条分支，现在需要将这些分支的输出进行聚合处理，再传输给结束节点。

![[LcYUb5HxUo2B7YxRl65chv0bnob.png]]

## 测试

试运行后，发现无关问题会走下面这条分支，符合预期。

![[XPVAbtqrUovAZ7xugtUcDiSDnfc.png]]

## 小结

如此我们通过意图识别更好地应对当用户问一些无关问题的场景。

# 存储数据到飞书多维表格

代码：

```
async def main(args: Args) -> Output:
    params = args.params
    ret: Output = {
        "records": [{"fields":{"问题":params["user"],"回复":params["bot"]}}]
    }
    return ret
```
