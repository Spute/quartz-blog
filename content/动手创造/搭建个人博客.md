---
title: æ­å»ºä¸ªäººåšå®¢
---

# é›¶æˆæœ¬æ­å»ºä¸ªäººåšå®¢ï¼šå…è´¹æ‹¥æœ‰ä½ çš„æ•°å­—è‡ªç•™åœ°

## å‰è¨€

é£ä¹¦äº‘æ–‡æ¡£åœ¨ç”µè„‘ç«¯çš„æ˜¾ç¤ºæŒºå¥½çš„ï¼Œå¯æ˜¯åœ¨ç§»åŠ¨ç«¯çš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ã€‚å¾ˆå¤šè‡ªå®šä¹‰çš„åŠŸèƒ½ç”¨ä¸äº†ã€‚

æ¯”å¦‚çŸ¥è¯†åº“çš„å­é¡µé¢åˆ—è¡¨ä¸æ”¯æŒæ˜¾ç¤ºï¼Œç”¨æˆ·ä»¥ä¸ºæˆ‘æ²¡ç»™ä»–å¼€æƒé™ã€‚ã€‚ã€‚

ä¸æ”¯æŒæœç´¢æ–‡ç« ã€‚ã€‚ã€‚

å¼„ä¸€ä¸ªè‡ªå·±çš„åšå®¢å§ï¼Œå¯ä»¥å¸¦æ¥ä»¥ä¸‹å¥½å¤„

- <strong>è®°å½•ä¸æˆé•¿</strong>ï¼šå†™åšå®¢æ˜¯è‡ªæˆ‘æ¢³ç†çš„è¿‡ç¨‹ï¼Œå¸®åŠ©æ·±åŒ–æ€è€ƒã€æ²‰æ·€çŸ¥è¯†ï¼Œæ–¹ä¾¿æ—¥åå›é¡¾ï¼Œä¿ƒè¿›ä¸ªäººè¿›æ­¥ã€‚
- <strong>å®Œå…¨è‡ªä¸»</strong>ï¼šæ‹¥æœ‰è‡ªå·±çš„å¹³å°ï¼Œä¸å—å…¶ä»–ç½‘ç«™å®¡æ ¸ã€é™æµæˆ–å…³åœçš„å½±å“ï¼Œå†…å®¹çœŸæ­£ç”±è‡ªå·±æŒæ§ã€‚
- <strong>æ‰“é€ ä¸ªäººå“ç‰Œ</strong>ï¼šæŒç»­åˆ†äº«èƒ½å½¢æˆä¸ªäººä¸“ä¸šå½¢è±¡ï¼Œå¯¹æ±‚èŒã€åˆä½œæˆ–å»ºç«‹å½±å“åŠ›éƒ½æœ‰é•¿æœŸå¥½å¤„ã€‚
- <strong>æŒç»­ç§¯ç´¯ä»·å€¼</strong>ï¼šæ–‡ç« èƒ½è¢«æœç´¢å¼•æ“æ”¶å½•ï¼Œéšæ—¶é—´ç§¯ç´¯ä¸æ–­å¸¦æ¥è¯»è€…ï¼Œå®ç°é•¿å°¾æ•ˆåº”ã€‚
- <strong>æ½œåœ¨æœºä¼š</strong>ï¼šè™½ä¸ç›´æ¥èµšé’±ï¼Œä½†å¯èƒ½å¸¦æ¥å’¨è¯¢ã€åˆä½œæˆ–çŸ¥è¯†ä»˜è´¹ç­‰é—´æ¥æ”¶ç›Šã€‚
- <strong>æ·±åº¦å¯¹æŠ—ç¢ç‰‡åŒ–</strong>ï¼šåœ¨å¿«èŠ‚å¥æ—¶ä»£ï¼Œåšå®¢æä¾›äº†ä¸€å—æ·±åº¦è¡¨è¾¾å’Œé˜…è¯»çš„ç©ºé—´ã€‚

å¯ä»¥å…ˆä»ç®€å•çš„é™æ€ç½‘ç«™å¼€å§‹ï¼Œä¸éœ€è¦è‡ªå·±çš„æœåŠ¡å™¨ï¼Œå…ˆä½¿ç”¨å¼€æºçš„å·¥å…·æ‰“åŒ…å¥½ï¼Œç„¶åç›´æ¥æ‰˜ç®¡åœ¨ github page æˆ–è€… cloudflare page ä¸­ï¼Œå‡ ä¹å¯ä»¥åšåˆ°å®Œå…¨å…è´¹å®ç°ã€‚

> é•¿å°¾æ•ˆåº”å°±æ˜¯é€šè¿‡å¤§é‡è§£å†³ç‰¹å®šé—®é¢˜çš„ä¼˜è´¨å†…å®¹ï¼ŒæŒç»­åœ°ä»æœç´¢å¼•æ“è·å¾—ç»†æ°´é•¿æµèˆ¬çš„ç¨³å®šæµé‡ã€‚è¿™æ˜¯åšå®¢åŒºåˆ«äºçŸ­è§†é¢‘ç­‰å¿«æ¶ˆå†…å®¹çš„æ ¸å¿ƒä»·å€¼ä¹‹ä¸€

## æ ¸å¿ƒåŠŸèƒ½

- åˆ†ç±»å†…å®¹ç®¡ç†
- æ ‡ç­¾å…³è”æ¨è
- è‡ªå®šä¹‰é¡µé¢è®¾è®¡
- å‹æƒ…é“¾æ¥å±•ç¤º
- å›¾åºŠèµ„æºç®¡ç†
- å¯è§†åŒ–ç«™ç‚¹é…ç½®
- SEO æœç´¢å¼•æ“ä¼˜åŒ–
- RSS è®¢é˜…åŠŸèƒ½
- è°·æ­Œå¹¿å‘Šæ¥å…¥
- å¤šé‡æ•°æ®å¤‡ä»½
- å…è´¹æ‰˜ç®¡æ”¯æŒ

# pelicanï¼špython æœ€çŸ¥åçš„é™æ€ç½‘ç«™

Pelican æ˜¯ä¸€å¥—å¼€æºçš„ä½¿ç”¨ Python ç¼–å†™çš„åšå®¢é™æ€ç”Ÿæˆ, å¯ä»¥æ·»åŠ æ–‡ç« å’Œå’Œåˆ›å»ºé¡µé¢, å¯ä»¥ä½¿ç”¨ MarkDownã€reStructuredText å’Œ AsiiDoc çš„æ ¼å¼æ¥æŠ’å†™, åŒæ—¶ä½¿ç”¨ Disqus è¯„è®ºç³»ç»Ÿ, æ”¯æŒ RSS å’Œ Atom è¾“å‡º, æ’ä»¶, ä¸»é¢˜, ä»£ç é«˜äº®ç­‰åŠŸèƒ½, é‡‡ç”¨ Jajin2 æ¨¡æ¿å¼•æ“, å¯ä»¥å¾ˆå®¹æ˜“çš„æ›´æ”¹æ¨¡æ¿ã€‚

github åœ°å€ï¼š[https://github.com/getpelican/pelican](https://github.com/getpelican/pelican)

é¡¹ç›®æ–‡æ¡£ï¼š[https://docs.getpelican.com/zh-cn/latest/quickstart.html](https://docs.getpelican.com/zh-cn/latest/quickstart.html)

## å¿«é€Ÿéƒ¨ç½²

1. å®‰è£… pythonï¼Œå¯å‚è€ƒ [python ç®€ä»‹å’Œå®‰è£…](https://iixchzsb7i.feishu.cn/wiki/L9XiwU7dMiU5kak6RdZc5Ngmnah)
2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå®‰è£… pelican

```
# å®‰è£… Pelican å¹¶åŒ…å« Markdown æ”¯æŒ
pip install "pelican[markdown]"
```

1. åˆå§‹åŒ–åšå®¢é¡¹ç›®

```typescript
<em># åˆ›å»ºåä¸º myblog çš„ç›®å½•</em>
mkdir myblog

<em># è¿›å…¥ myblog ç›®å½•</em>
cd myblog/

# å¿«é€Ÿåˆå§‹åŒ– Pelican åšå®¢é¡¹ç›®ï¼ˆç”Ÿæˆé…ç½®æ–‡ä»¶ç›®å½•ç»“æ„ï¼‰ï¼Œæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚å¯ä¸€ç›´å›è½¦ç¡®è®¤
pelican-quickstart
```

1. æ·»åŠ åšå®¢å†…å®¹

åœ¨é¡¹ç›®ç›®å½•çš„ content ä¸‹ï¼Œæ·»åŠ ä¸€ä¸ª md æ ¼å¼æ–‡ç« å†…å®¹æ–‡ä»¶ï¼Œå¯ä»¥å…ˆç”¨ä»¥ä¸‹å†…å®¹æµ‹è¯•

```
Title: My First Review
Date: 2010-12-03 10:20
Category: Review

Following is a review of my favorite mechanical keyboard.
```

1. æœ¬åœ°è¿è¡Œæµ‹è¯•ï¼š

```
# ç”Ÿæˆé™æ€ç½‘ç«™ï¼ˆå¤„ç† content ç›®å½•ä¸‹çš„å†…å®¹ï¼‰
pelican content

# å¯åŠ¨æœåŠ¡å™¨å¹¶ç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£ï¼ˆå…è®¸å¤–éƒ¨è®¾å¤‡è®¿é—®ï¼‰
pelican --listen -b 0.0.0.0
```

æµè§ˆå™¨æ‰“å¼€åœ°å€ï¼Œå³å¯è®¿é—®å¦‚ä¸‹åšå®¢ç½‘é¡µ

![[UfFLbm6iToKcvixLch9c3nK5n6f.png]]

## é¡¹ç›®ç›®å½•

```
.
â”œâ”€â”€ content          <em># æ–‡ç« å†…å®¹ç›®å½• - å­˜æ”¾æ‰€æœ‰çš„Markdownæ–‡ç« ã€é¡µé¢å’Œé™æ€æ–‡ä»¶ï¼ˆå›¾ç‰‡ç­‰ï¼‰</em>
â”œâ”€â”€ Makefile         <em># è‡ªåŠ¨åŒ–è„šæœ¬æ–‡ä»¶ - åŒ…å«å¸¸ç”¨çš„æ„å»ºã€å‘å¸ƒå‘½ä»¤ï¼ˆmake html, make publishç­‰ï¼‰</em>
â”œâ”€â”€ output           <em># è¾“å‡ºç›®å½• - ç”Ÿæˆçš„é™æ€ç½‘ç«™æ–‡ä»¶ï¼ˆHTMLã€CSSã€JSç­‰ï¼‰</em>
â”œâ”€â”€ pelicanconf.py   <em># ä¸»é…ç½®æ–‡ä»¶ - æœ¬åœ°å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒçš„é…ç½®</em>
â”œâ”€â”€ publishconf.py   <em># å‘å¸ƒé…ç½®æ–‡ä»¶ - ç”Ÿäº§ç¯å¢ƒçš„ä¼˜åŒ–é…ç½®ï¼ˆé€šå¸¸ç»§æ‰¿pelicanconf.pyï¼‰</em>
â””â”€â”€ tasks.py         <em># ä»»åŠ¡è„šæœ¬æ–‡ä»¶ - å¯é€‰çš„è‡ªå®šä¹‰è‡ªåŠ¨åŒ–ä»»åŠ¡ï¼ˆé€šå¸¸ç”¨äºInvokeå·¥å…·ï¼‰</em>
```

## <strong>é…ç½®ä¸»é¢˜</strong>

pelican å®˜æ–¹åˆ›å»ºäº†ä¸€ä¸ªç¤¾åŒºï¼Œé‡Œé¢æœ‰ä¸°å¯Œçš„ä¸»é¢˜ï¼Œä»é‡Œé¢æŒ‘é€‰å‡ºè‡ªå·±å–œæ¬¢çš„ä¸»é¢˜å§ï¼Œå¤§å¤šæ•°ä¸»é¢˜é¢„è§ˆç•Œé¢ä½ å¯ä»¥æ‰“å¼€è¿™ä¸ª<u>ç½‘é¡µ</u>è¿›è¡ŒæŸ¥çœ‹ã€‚æœ€å…¨çš„ä¸»é¢˜å¯åœ¨ github ä»“åº“æŸ¥çœ‹ï¼š<u>pelican ä¸»é¢˜å¼€æºåº“</u>ã€‚

æ¯”å¦‚é€‰æ‹©ä¸­äº†å¦‚ä¸‹ä¸»é¢˜ï¼Œè®°ä½ä¸»é¢˜åç§°â€œgumâ€ã€‚

![[JhvUbkgjooDCPGxf0VHc5Wl7n6d.png]]

å›åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼ŒæŒ‰å¦‚ä¸‹æ­¥éª¤æ“ä½œï¼š

å…‹éš†ä¸»é¢˜åˆ°æœ¬åœ°

```
git clone https://github.com/getpelican/pelican-themes.git
```

- æ‰“å¼€ `pelicanconf.py` é…ç½®æ–‡ä»¶ï¼Œæ›´æ”¹æˆ–æ·»åŠ  THEME ä¸ºè‡ªå·±å–œæ¬¢çš„ä¸»é¢˜ã€‚ä¾‹å¦‚æœ¬åšå®¢æ‰€æŒ‘é€‰çš„ gumï¼ˆæµ‹è¯•ä¸‹æ¥éƒ¨åˆ†ä¸»é¢˜å¦‚ Flexï¼Œæ— æ³•ç›´æ¥ç”Ÿæ•ˆï¼Œå¯èƒ½éœ€è¦é¢å¤–é…ç½®ï¼‰ã€‚

æ›´å¤šçš„é…ç½®å«ä¹‰è¯·å…³æ³¨<u>å®˜æ–¹æ–‡æ¡£</u>ã€‚

```
THEME = 'pelican-themes/Flex'
```

ç„¶åå‘½ä»¤è¡Œé‡æ–°æ‰§è¡Œ

```
# è°ƒç”¨ Pelican æ ¹æ®ä½ ä¿®æ”¹è¿‡çš„é…ç½®é‡æ–°ç”Ÿæˆé™æ€ç½‘ç«™æ–‡ä»¶ã€‚
make html

# å¯åŠ¨æœåŠ¡å™¨å¹¶ç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£ï¼ˆå…è®¸å¤–éƒ¨è®¾å¤‡è®¿é—®ï¼‰
pelican --listen -b 0.0.0.0
```

æœ¬åœ°è¿è¡Œåï¼Œåœ¨æµè§ˆå™¨æŸ¥çœ‹å‘ç°ä¸»é¢˜æ›¿æ¢æˆåŠŸ

![[PKfLbu8hfobsm4xBsExcPto8nHf.png]]

### ä¸»é¢˜ elegant

[https://pelicanthemes.com/elegant/](https://pelicanthemes.com/elegant/)

## åŠ å…¥å›¾ç‰‡

<strong>è¡¥å……</strong>ï¼šè¦æ’å…¥å›¾ç‰‡çš„è¯ï¼Œæˆ‘é€‰æ‹©åœ¨ content æ–‡ä»¶å¤¹å†…æ–°å»º"images"æ–‡ä»¶å¤¹ï¼Œåœ¨è¿™ä¸ªè·¯å¾„ä¸‹æ”¾å›¾ç‰‡æˆ–è€…å†æ–°å»ºæ–‡ä»¶å¤¹æ”¾å›¾ç‰‡ï¼Œcontent é‡Œçš„æ–‡ä»¶é‡Œç”¨ markdown è¯­è¨€å†™æ˜å›¾ç‰‡è·¯å¾„å°±å¥½ï¼Œç»è¿‡ç¢ç£¨ windows ç³»ç»Ÿçš„è¯è·¯å¾„å¯ä»¥è¿™ä¹ˆå†™ï¼ˆæˆ‘çš„ç¼–è¾‘å™¨æ˜¯ VS Codeï¼‰ï¼š

```
![å›¾ç‰‡alt](/images/your_folder_if_exists/picture.jpg "å›¾ç‰‡title")
```

åœ¨é…ç½®æ–‡ä»¶ `pelicanconf.py` ä¸­æ·»åŠ 

```
STATIC_PATHS = ['images']
```

åæ¥å‘ç°ç”Ÿæˆçš„ç½‘é¡µæ‰“å¼€åï¼Œå›¾ç‰‡æ˜¾ç¤ºä¸å…¨ï¼Œå¤§ç‚¹çš„å›¾ç‰‡å³è¾¹éƒ½è¢«ç æ‰äº†ï¼Œåº”è¯¥æ˜¯åŸå›¾å¤§å°è¶…å‡ºäº†é¡µé¢å¤§å°ï¼Œä¸‹è½½ä¸‹æ¥æ˜¯æ­£å¸¸çš„ï¼Œç»è¿‡æœç´¢æ‘¸ç´¢å‡ºäº†è§£å†³æ–¹æ³•ï¼Œç›´æ¥åœ¨ url åé¢åŠ ä¸Š CSS æ ·å¼ï¼Œä¾‹å¦‚ï¼š

{:height="100%" width="100%"} æˆ– {:width="100%"}

ç»“åˆèµ·æ¥å°±æ˜¯ï¼š

```
![å›¾ç‰‡alt](/images/your_folder_if_exists/picture.jpg "å›¾ç‰‡title"){:height="100%" width="100%"}
```

# åšå®¢è‡ªåŠ¨éƒ¨ç½²å®è·µï¼šGitHub Actions é›†æˆ Cloudflare Pages

## å‰è¨€

Cloudflare Pages çš„æ„å»ºç¯å¢ƒç›¸å¯¹ç®€å•ï¼Œåªæ”¯æŒå°‘æ•°å‘½ä»¤ã€‚å¦‚æœé¡¹ç›®æ„å»ºè¿‡ç¨‹æ›´å¤æ‚ï¼Œæ¯”å¦‚éœ€è¦å¤šæ­¥ç¼–è¯‘æˆ–ä¾èµ–ç‰¹æ®Šè„šæœ¬ï¼Œå¯ä»¥é€šè¿‡ GitHub Actions æ¥æ¥ç®¡æ•´ä¸ªæ„å»ºæµç¨‹ï¼Œå¹¶æœ€ç»ˆè‡ªåŠ¨å‘å¸ƒåˆ° Cloudflare Pagesã€‚

æœ€è¿‘æˆ‘åˆšå¥½åœ¨éƒ¨ç½²ä¸€ä¸ª Pelican åšå®¢ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹æˆ‘çš„å®è·µè¿‡ç¨‹ã€‚

## Workflow æ–‡ä»¶ç¤ºä¾‹

å®ç°è¿™ä¸ªè‡ªåŠ¨åŒ–æ ¸å¿ƒæ˜¯ï¼Œåœ¨ GitHub ä»“åº“æ·»åŠ  `.github/workflows/pelican.yml`ï¼Œå¦‚ä¸‹ï¼š

```yaml
name: Build and Deploy Pelican
on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install pelican markdown

      - name: Build site
        run: |
          pelican content -o output -s pelicanconf.py

      - name: Deploy to Cloudflare Pages
        uses: cloudflare/pages-action@v1
        with:
          apiToken: ${{ secrets.CF_API_TOKEN }}
          accountId: ${{ secrets.CF_ACCOUNT_ID }}
          projectName: your-project-name   # âš ï¸ æ”¹æˆä½ çš„ Cloudflare Pages é¡¹ç›®å
          directory: ./output
```

<strong>å…¶ä¸­å…³é”®åœ¨äºè·å– Cloudflare å’Œ GitHub çš„å®‰å…¨å‡­è¯ï¼Œç”¨äºæˆæƒè‡ªåŠ¨éƒ¨ç½²</strong>ã€‚

è¿™äº›å˜é‡ä¸­ï¼Œ<strong>å‰ä¸¤ä¸ªéœ€è¦æ”¾åˆ° GitHub Secrets ä¸­</strong>ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ç›´æ¥å†™åœ¨ workflow æ–‡ä»¶é‡Œçš„æ™®é€šå­—ç¬¦ä¸²ã€‚

## è·å– Cloudflare å‡­è¯

### è·å– <strong>Account ID</strong>

- ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/)
- é€‰æ‹©ä»»æ„ç«™ç‚¹ï¼ˆæˆ–ç›´æ¥è¿›å…¥é¦–é¡µï¼‰
- å³ä¸Šè§’ç‚¹å‡»ä½ çš„å¤´åƒ â†’ <strong>My Profile</strong> â†’ <strong>API Tokens</strong>
- ä½ ä¼šåœ¨é¡µé¢é¡¶éƒ¨çœ‹åˆ°ï¼š

```
Account ID: xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

- æˆ–åœ¨ Pages é¡¹ç›®é‡Œæ‰¾åˆ°ï¼š

> - Pages â†’ ä½ çš„é¡¹ç›® â†’ Overview â†’ Account ID

![[ZmWlbAFzjoZFAUxnCRgcVHmpntG.png]]

### åˆ›å»º <strong>API Token</strong>

1. åœ¨ <strong>My Profile â†’ API Tokens â†’ Create Token</strong>
2. é€‰æ‹©æ¨¡æ¿ï¼š
   ğŸ”¹ <strong>â€œEdit Cloudflare Pagesâ€</strong> æ¨¡æ¿ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œå°±ç”¨ Customï¼‰
3. è®¾ç½®æƒé™å¦‚ä¸‹ï¼š

```
Permissions:
  Account / Cloudflare Pages / Edit
```

1. å¹¶æŒ‡å®šä½ çš„è´¦å·èŒƒå›´ï¼ˆAccount Resources â†’ Include â†’ Your Accountï¼‰
2. åˆ›å»ºåä¼šç”Ÿæˆä¸€ä¸²é•¿é•¿çš„ Tokenï¼Œå½¢å¦‚ï¼š

```
8f3bfe82c6a78f50a6f6b8dc************
```

1. âš ï¸ åªä¼šæ˜¾ç¤ºä¸€æ¬¡ï¼Œè¯·ç«‹åˆ»å¤åˆ¶ä¿å­˜ï¼

![[YJc2b1G3koQxQfxKF6ecQIl3ndb.png]]

## åœ¨ GitHub ä¸­é…ç½® Secrets

1. æ‰“å¼€ä½ çš„ GitHub ä»“åº“
2. è¿›å…¥ï¼š

```
Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret
```

1. åˆ†åˆ«æ·»åŠ ï¼š

å®Œæˆåå®ƒä»¬ä¼šä¿å­˜åœ¨ GitHub ä»“åº“çš„ç§å¯†ç©ºé—´ä¸­ï¼Œ

åªèƒ½è¢« GitHub Actions ä½¿ç”¨ï¼Œåˆ«äººçœ‹ä¸åˆ°ã€‚

![[TSz7bFjEdoTQdhxYFikcTZzsn2g.png]]

## éªŒè¯æ˜¯å¦æˆåŠŸéƒ¨ç½²

1. æ¨é€æ›´æ–°åˆ° `main` åˆ†æ”¯åï¼Œ
   GitHub Actions ä¼šè‡ªåŠ¨è§¦å‘æ„å»ºã€‚
2. åœ¨ Cloudflare Pages æ§åˆ¶å° â†’ é¡¹ç›® â†’ <strong>Deployments</strong> ä¸­å¯ä»¥çœ‹åˆ°ï¼š

```
Deployed from GitHub Actions
```

1. åœ¨ cloudflare page é¡µé¢çœ‹åˆ°éƒ¨ç½²è®°å½•ï¼Œå·²æˆåŠŸéƒ¨ç½²

![[BAkib1KqloGg50x0Myic4sdvnKc.png]]

1. ç™»å½•éƒ¨ç½²æˆåŠŸçš„ç½‘ç«™æŸ¥çœ‹æ•ˆæœ https://pelican-blog.520233.best/

![[GyqLbJ3RwoqKnNx5yImcH3WanWf.png]]

# åšå®¢è‡ªåŠ¨éƒ¨ç½²å®è·µï¼šcloudflare r2 æ¥æ‰˜ç®¡é™æ€æ–‡ä»¶

## å‰è¨€

åœ¨ä½¿ç”¨ Pelican æ„å»ºé™æ€åšå®¢æ—¶ï¼Œ`/static` ç›®å½•ä¸‹çš„å›¾ç‰‡ç­‰èµ„æºä¼šéš HTML ä¸€èµ·å‘å¸ƒåˆ° Cloudflare Pagesã€‚ç„¶è€Œï¼Œéšç€åšå®¢å†…å®¹å¢å¤šï¼Œé™æ€èµ„æºä½“ç§¯ä¹Ÿä¼šè¶Šæ¥è¶Šå¤§ï¼Œå¯¼è‡´ Cloudflare Pages æ„å»ºæ—¶é—´å¢é•¿ï¼Œéƒ¨ç½²ä½“ç§¯å˜å¤§ï¼Œè¶…å‡º 25Mï¼ˆæ²¡è®°é”™çš„è¯ï¼‰åå°±æ— æ³•éƒ¨ç½²äº†ã€‚

ä¸€ç§é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆæ˜¯ <strong>å°†é™æ€èµ„æºå•ç‹¬æ‰˜ç®¡åˆ°æ–‡ä»¶ç®¡ç†ç³»ç»Ÿï¼Œæ¯”å¦‚ Cloudflare R2</strong>ï¼Œå¹¶åœ¨ HTML ä¸­æ›¿æ¢è·¯å¾„ï¼Œä½¿æµè§ˆå™¨ç›´æ¥é€šè¿‡ CDN åŠ è½½èµ„æºã€‚è¿™ä¸ä»…å‡è½»äº† Pages æ„å»ºå‹åŠ›ï¼Œä¹Ÿæå‡äº†è®¿é—®æ€§èƒ½ã€‚

ä¹‹æ‰€ä»¥é€‰ Cloudflare R2ï¼Œæ˜¯å› ä¸ºå®ƒå¯¹ä¸ªäººå¼€å‘è€…å’Œå°å‹åšå®¢æ¥è¯´å‡ ä¹<strong>å…è´¹åˆé«˜æ•ˆ</strong>â€”â€”å­˜å‚¨ <strong>10GB å†…å…è´¹ï¼Œä¸Šä¼ ã€è¯»å–æ¬¡æ•°ç™¾ä¸‡çº§å…è´¹ï¼Œå‡ºå£æµé‡ä¹Ÿå…è´¹</strong>ï¼Œéå¸¸é€‚åˆæ‰˜ç®¡é™æ€èµ„æºã€‚

æœ¬æ–‡å°†è¯¦ç»†è®²è§£å¦‚ä½•åœ¨ GitHub Actions ä¸­å®ç°è¿™ä¸ªæµç¨‹ã€‚

## æ“ä½œæ­¥éª¤

### Cloudflare R2 é…ç½®

1. ç™»å½• Cloudflare Dashboard
2. è¿›å…¥ <strong>R2 å­˜å‚¨ (R2 Storage)</strong> â†’ <strong>Create Bucket</strong> åˆ›å»ºå­˜å‚¨æ¡¶ï¼Œä¾‹å¦‚ `my-blog-bucket`
3. æ‰“å¼€ <strong>Access Keys</strong> â†’ <strong>Cre</strong><strong>ate Access Keyï¼Œ</strong>ç”Ÿæˆ `Secret Access Key`ï¼Œè®°å½•ä¸‹æ¥ï¼ŒSecret åªæ˜¾ç¤ºä¸€æ¬¡

![[UUWMb7gIQogqGVx1GGVcaQ1lnYc.png]]

1. `è·å– Access Key ID`
2. è·å– R2 Endpointï¼Œ

   1. ä¾‹å¦‚ï¼š`https://<accountid>.r2.cloudflarestorage.com`

âš ï¸ <strong>ä¸è¦åœ¨ endpoint ä¸­åŠ ä¸Š bucket åç§°</strong>

![[LDASbJiFDoY4zbxl3uCcdFlKnMd.png]]

### åœ¨ GitHub ä»“åº“é…ç½® Secrets

åœ¨ä»“åº“ Settings â†’ Secrets â†’ Actions ä¸­æ–°å¢ï¼š

![[DbWubff8yopBGLx2xRscx3Hyngg.png]]

### åœ¨ workflow ä¸­ä½¿ç”¨ rclone ä¸Šä¼ é™æ€æ–‡ä»¶

```bash
# -------------------------------
      # 6ï¸âƒ£ åœ¨ GitHub Actions ä¸­å®‰è£… rclone
      # -------------------------------
      - name: Setup rclone
        run: |
          curl https://rclone.org/install.sh | sudo bash

      # -------------------------------
      # 5ï¸âƒ£ é…ç½® rclone ä¸ R2
      # -------------------------------
      - name: Configure rclone for R2
        run: |
          mkdir -p ~/.config/rclone
          rclone config create r2 s3 \
          provider Cloudflare \
          access_key_id "${{ secrets.R2_ACCESS_KEY_ID }}" \
          secret_access_key "${{ secrets.R2_SECRET_ACCESS_KEY }}" \
          endpoint "${{ secrets.R2_ENDPOINT }}" \
          region auto \
          --non-interactive \
          --config ~/.config/rclone/rclone.conf

      # -------------------------------
      # 6ï¸âƒ£ åŒæ­¥ /output/static åˆ° R2
      # -------------------------------
      - name: Upload static files to R2
        run: |
          echo "â˜ï¸ åŒæ­¥é™æ€èµ„æºåˆ° R2..."
          rclone sync output/static "r2:${R2_BUCKET}/static" --progress
```

## æ›¿æ¢ HTML ä¸­é™æ€è·¯å¾„

ç›´æ¥å…¨å±€æ›¿æ¢ `/static/` å¯èƒ½è¯¯ä¼¤æ­£æ–‡ï¼Œå› æ­¤åªæ›¿æ¢ HTML `src` å’Œ `href` å±æ€§ï¼š

```
- name: Replace static URLs in HTML
  run: |
    find output -type f -name "*.html" -print0 | \
    xargs -0 sed -E -i "s|(src|href)=[\"']\/static\/|\1=\"${{ secrets.R2_PUBLIC_URL }}/static/|g"
```

æ›¿æ¢æ•ˆæœï¼š

`<img src="/static/logo.png">`â†’`<img src="https://cdn.example.com/static/logo.png">`

ç¡®ä¿æ­£æ–‡ä¸­å‡ºç°çš„ `static` ä¸ä¼šè¢«è¯¯æ”¹ã€‚

## Workflow æ–‡ä»¶ç¤ºä¾‹

ä»£ç å·²åœ¨[ GitHub](https://github.com/Spute/pelican-blog) å¼€æº ï¼Œæ–‡ä»¶åœ°å€ `.github/workflows/pelican.yml`ï¼Œå¦‚ä¸‹ï¼š

```bash
# æ–‡ä»¶è·¯å¾„ï¼š.github/workflows/pelican.yml
# ç”¨é€”ï¼šåœ¨æ¨é€åˆ° main åˆ†æ”¯æ—¶ï¼Œè‡ªåŠ¨æ„å»º Pelican é™æ€ç½‘ç«™ï¼Œå¹¶éƒ¨ç½²åˆ° Cloudflare Pages

name: Build and Deploy Pelican

on:
  push:
    branches: [ main ]   # ğŸš€ å½“æ¨é€åˆ° main åˆ†æ”¯æ—¶è‡ªåŠ¨è§¦å‘æ„å»ºï¼ˆå¯æ ¹æ®éœ€è¦ä¿®æ”¹ï¼‰

jobs:
  build:
    runs-on: ubuntu-latest   # ğŸ’» ä½¿ç”¨æœ€æ–°çš„ Ubuntu ç¯å¢ƒä½œä¸ºæ„å»ºæœº
    env:
      R2_BUCKET: ${{ secrets.CF_R2_BUCKET }}           # ğŸ” ä» GitHub Secrets è¯»å– R2 Bucket åç§°
      R2_PUBLIC_URL: ${{ secrets.CF_R2_PUBLIC_URL }}   # ğŸ” ä» GitHub Secrets è¯»å– R2 å…¬å…± URL
    steps:
      # ==============================
      # 1ï¸âƒ£ æ‹‰å–é¡¹ç›®ä»£ç ï¼ˆåŒ…å«ä¸»é¢˜å­æ¨¡å—ï¼‰
      # ==============================
      - name: Checkout repository (include submodules)
        uses: actions/checkout@v4
        with:
          submodules: true     # âœ… å…³é”®ï¼šç¡®ä¿ä¸»é¢˜ï¼ˆsubmoduleï¼‰ä¸€å¹¶è¢«ä¸‹è½½
          fetch-depth: 0       # å»ºè®®å®Œæ•´æ‹‰å–åˆ†æ”¯ä¿¡æ¯ï¼ˆæœ‰äº› Pelican æ’ä»¶ä¾èµ– git ä¿¡æ¯ï¼‰

      # ==============================
      # 2ï¸âƒ£ å®‰è£… Python ç¯å¢ƒ
      # ==============================
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'  # âš™ï¸ æŒ‡å®š Python ç‰ˆæœ¬

      # ==============================
      # 3ï¸âƒ£ å®‰è£… Pelican åŠä¾èµ–
      # ==============================
      - name: Install dependencies
        run: |
          pip install pelican markdown   # âœï¸ æ ¹æ®ä½ çš„é¡¹ç›®éœ€è¦ï¼Œä¹Ÿå¯ä»¥åŠ æ’ä»¶ä¾èµ–ï¼Œæ¯”å¦‚ pelican[markdown,typogrify]

      # ==============================
      # 4ï¸âƒ£ æ„å»º Pelican é™æ€ç½‘ç«™
      # ==============================
      - name: Build site
        run: |
          pelican content -o output -s pelicanconf.py
          # â¬†ï¸
          # content/          â†’ ä½ çš„ Markdown æˆ– rst æ–‡ä»¶ç›®å½•
          # output/           â†’ Pelican ç”Ÿæˆçš„é™æ€ç½‘ç«™è¾“å‡ºç›®å½•
          # pelicanconf.py    â†’ Pelican é…ç½®æ–‡ä»¶

      # -------------------------------
      # 6ï¸âƒ£ åœ¨ GitHub Actions ä¸­å®‰è£… rclone
      # -------------------------------
      - name: Setup rclone
        run: |
          curl https://rclone.org/install.sh | sudo bash

      # -------------------------------
      # 5ï¸âƒ£ é…ç½® rclone ä¸ R2
      # -------------------------------
      - name: Configure rclone for R2
        run: |
          mkdir -p ~/.config/rclone
          rclone config create r2 s3 \
          provider Cloudflare \
          access_key_id "${{ secrets.R2_ACCESS_KEY_ID }}" \
          secret_access_key "${{ secrets.R2_SECRET_ACCESS_KEY }}" \
          endpoint "${{ secrets.R2_ENDPOINT }}" \
          region auto \
          --non-interactive \
          --config ~/.config/rclone/rclone.conf

      # -------------------------------
      # 6ï¸âƒ£ åŒæ­¥ /output/static åˆ° R2
      # -------------------------------
      - name: Upload static files to R2
        run: |
          echo "â˜ï¸ åŒæ­¥é™æ€èµ„æºåˆ° R2..."
          rclone sync output/static "r2:${R2_BUCKET}/static" --progress

      # -------------------------------
      # 7ï¸âƒ£ æ›¿æ¢ HTML ä¸­ /static/ è·¯å¾„
      # -------------------------------
      - name: Replace static URLs in HTML
        run: |
          echo "ğŸ”„ æ›¿æ¢ HTML å†…çš„é™æ€èµ„æºè·¯å¾„..."
          find output -type f -name "*.html" -print0 | \
          xargs -0 sed -i -E "s|src=['\"]\/static\/|src=\"${R2_PUBLIC_URL}/static/|g"
          find output -type f -name "*.html" -print0 | \
          xargs -0 sed -i -E "s|href=['\"]\/static\/|href=\"${R2_PUBLIC_URL}/static/|g"

      # -------------------------------
      # 8ï¸âƒ£ éªŒè¯ä¸Šä¼ ç»“æœå¹¶åˆ é™¤ static
      # -------------------------------
      - name: Verify and clean up static
        run: |
          echo "ğŸ” éªŒè¯ R2 ä¸Šä¼ ..."
          if rclone check output/static "r2:${R2_BUCKET}/static" --one-way --size-only; then
            echo "âœ… æ–‡ä»¶éªŒè¯é€šè¿‡ï¼Œåˆ é™¤æœ¬åœ° output/static"
            rm -rf output/static
          else
            echo "âŒ æ£€æŸ¥å¤±è´¥ï¼Œä¿ç•™æœ¬åœ°æ–‡ä»¶"
            exit 1
          fi

      # ==============================
      # 5ï¸âƒ£ éƒ¨ç½²åˆ° Cloudflare Pages
      # ==============================
      - name: Deploy to Cloudflare Pages
        uses: cloudflare/pages-action@v1
        with:
          apiToken: ${{ secrets.CF_API_TOKEN }}     # ğŸ” ä» GitHub Secrets è¯»å– Cloudflare API Token
          accountId: ${{ secrets.CF_ACCOUNT_ID }}   # ğŸ” ä» GitHub Secrets è¯»å– Cloudflare Account ID
          projectName: pelican-blog                 # âš ï¸ æ›¿æ¢æˆä½ åœ¨ Cloudflare Pages çš„é¡¹ç›®å
          directory: ./output                       # ğŸŒ æŒ‡å®šè¦ä¸Šä¼ çš„é™æ€æ–‡ä»¶ç›®å½•ï¼ˆå³ Pelican è¾“å‡ºç›®å½•ï¼‰
```

# åšå®¢è‡ªåŠ¨åŒ–éƒ¨ç½²å®è·µï¼šä½¿ç”¨ python è„šæœ¬æ›¿æ¢ HTML ä¸­çš„é™æ€èµ„æºè·¯å¾„

## å‰è¨€

åœ¨ GitHub Actions çš„æ„å»ºæµç¨‹ä¸­ï¼Œå› ä¸ºå·²ç»å°†é™æ€æ–‡ä»¶ä¼ è¾“åˆ° R2 ä¸Šï¼Œæ‰€ä»¥éœ€è¦æ›¿æ¢é™æ€èµ„æºè·¯å¾„ã€‚ä¹‹å‰ä½¿ç”¨ shell è„šæœ¬å®ç°çš„æ•ˆæœä¸å¤ªå¥½ï¼Œæˆ‘ä»¬ä½¿ç”¨ python è„šæœ¬æ¥ä¼˜åŒ–ä¸€ä¸‹ã€‚

è¯¥è„šæœ¬ç›®æ ‡æ˜¯é€šè¿‡è§£æ `output` ç›®å½•ä¸‹çš„ HTML æ–‡ä»¶ï¼Œç²¾å‡†åœ°æ›¿æ¢ `src` å’Œ `href` å±æ€§ä¸­çš„ `/static/` è·¯å¾„ä¸º Cloudflare R2 çš„å…¬ç½‘ URLã€‚

## å®ç°è¿‡ç¨‹

ä½¿ç”¨ `BeautifulSoup` åº“è§£æ HTML ç»“æ„ï¼Œç¡®ä¿ä»…ä¿®æ”¹æ ‡ç­¾ä¸­çš„é™æ€èµ„æºè·¯å¾„ï¼Œè€Œä¸ä¼šè¯¯æ”¹å…¶ä»–æ–‡æœ¬å†…å®¹ã€‚å¹¶ä¸”å¯ä»¥æ‰“å°å‡ºæ›´å‡†ç¡®çš„æ—¥å¿—ï¼Œæ–¹ä¾¿æ’é”™ã€‚æ•ˆæœå¦‚ä¸‹ï¼š

![[WqVMbYdAbofxVQxCA0jcWrw2n7d.png]]

è„šæœ¬å®Œæ•´ä»£ç ï¼š

```python
import os
import re
from bs4 import BeautifulSoup

# éœ€è¦æ›¿æ¢çš„è·¯å¾„å‰ç¼€
R2_PUBLIC_URL = "https://blog-cdn.520233.best"  # æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ R2 å…¬ç½‘ URL

# éå†æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰ .html æ–‡ä»¶
def replace_static_paths_in_html(directory: str, url_prefix: str):
    for root, dirs, files in os.walk(directory):
        for file in files:
            if file.endswith(".html"):
                file_path = os.path.join(root, file)
                print(f"æ­£åœ¨å¤„ç†æ–‡ä»¶: {file_path}")

                # è¯»å– HTML æ–‡ä»¶
                with open(file_path, "r", encoding="utf-8") as f:
                    content = f.read()

                # ä½¿ç”¨ BeautifulSoup è§£æ HTML
                soup = BeautifulSoup(content, "html.parser")

                # æ‰¾åˆ°æ‰€æœ‰å¸¦æœ‰ src æˆ– href å±æ€§çš„æ ‡ç­¾ï¼Œå¹¶æ›¿æ¢è·¯å¾„
                modified = False

                # æ›¿æ¢ <img> å’Œå…¶ä»–å¸¦ src å±æ€§çš„æ ‡ç­¾
                for tag in soup.find_all(src=True):
                    original_src = tag['src']
                    if original_src.startswith("/static/"):
                        new_src = f"{url_prefix}{original_src}"
                        tag['src'] = new_src
                        modified = True
                        print(f"ä¿®æ”¹ï¼šsrc={original_src} -> src={new_src}")

                # æ›¿æ¢ <link> å’Œå…¶ä»–å¸¦ href å±æ€§çš„æ ‡ç­¾
                for tag in soup.find_all(href=True):
                    original_href = tag['href']
                    if original_href.startswith("/static/"):
                        new_href = f"{url_prefix}{original_href}"
                        tag['href'] = new_href
                        modified = True
                        print(f"ä¿®æ”¹ï¼šhref={original_href} -> href={new_href}")

                # å¦‚æœå†…å®¹æœ‰ä¿®æ”¹ï¼Œå†™å›æ–‡ä»¶
                if modified:
                    with open(file_path, "w", encoding="utf-8") as f:
                        f.write(str(soup))
                    print(f"æ–‡ä»¶å·²æ›´æ–°ï¼š{file_path}")

# è¿è¡Œè„šæœ¬
if __name__ == "__main__":
    output_directory = "output"  # æ›¿æ¢ä¸ºä½ çš„æ–‡ä»¶å¤¹è·¯å¾„
    replace_static_paths_in_html(output_directory, R2_PUBLIC_URL)
```

ç„¶åå†æ›¿æ¢åˆ° workflow æ–‡ä»¶ä¸­

```
# -------------------------------
      # 5ï¸âƒ£ æ‰§è¡Œ static_link_replace.py æ›¿æ¢ HTML ä¸­çš„é™æ€èµ„æºè·¯å¾„
      # -------------------------------
      - name: Run static_link_replace.py
        run: |
          python static_link_replace.py
```

# Halo å¼€æºåšå®¢é¡¹ç›®

[https://github.com/halo-dev/halo](https://github.com/halo-dev/halo)

é¡¹ç›®

# èµ„æ–™

åœ¨ github ä¸Šæ‰¾åˆ°é™æ€ç½‘ç«™ç”Ÿæˆå™¨ topicï¼Œ[https://github.com/topics/static-site-generator](https://github.com/topics/static-site-generator)ï¼Œæœ‰å„ç§è¯­è¨€çš„é¡¹ç›®ï¼Œå…ˆè¯•è¯•ä¸€ä¸ª python è¯­è¨€çš„
